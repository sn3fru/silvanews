<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.I.L.V.A. - AlphaNews</title>
    <link rel="preload" href="/frontend/style.css?v=1.0.5" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/frontend/style.css?v=1.0.5"></noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <script>
    // Prote√ß√£o simples por login (localStorage)
    (function(){
        try {
            const auth = JSON.parse(localStorage.getItem('silva_auth') || '{}');
            if (!auth || auth.username !== 'admin' || auth.token !== 'admin') {
                window.location.href = '/frontend/login.html';
            }
        } catch (e) {
            window.location.href = '/frontend/login.html';
        }
    })();
    </script>

    <div class="container">
        <aside class="painel-controle">
            <div class="logo">
                <h1>S.I.L.V.A.</h1>
                <div class="logo-subtitle">
                    <span><span class="sigla">S</span>istema <span class="sigla">I</span>nteligente de <span class="sigla">L</span>eitura e <span class="sigla">V</span>erifica√ß√£o <span class="sigla">A</span>utomatizada</span>
                </div>
            </div>

            <section class="secao-filtro">
                <h2>Prioridades</h2>
                <div class="filtros-rapidos" id="filtros-prioridade">
                    <button class="filtro-btn" data-priority="P1_CRITICO">P1 Cr√≠tico</button>
                    <button class="filtro-btn" data-priority="P2_ESTRATEGICO">P2 Estrat√©gico</button>
                    <button class="filtro-btn" data-priority="P3_MONITORAMENTO">P3 Monitoramento</button>
                </div>
            </section>

            <section class="secao-filtro">
                <h2>Mesas</h2>
                <nav class="feeds-personalizados">
                    <a href="#" class="feed-link ativo">Special Situations</a>
                    <a href="#" class="feed-link">Enforce</a>
                </nav>
                <button id="btn-criar-feed" class="btn btn-terciario">+ Criar Novo Feed</button>
            </section>

            <section class="secao-filtro">
                <h2>Categorias</h2>
                <div class="filtros-categorias" id="filtros-categoria">
                                <!-- Tags ser√£o carregadas dinamicamente via JavaScript -->
                </div>
            </section>
        </aside>

        <main class="conteudo-principal">
            <!-- Seletor de Data e M√©tricas -->
            <div class="seletor-data">
                <div class="data-info">
                    <span class="data-label">Not√≠cias de:</span>
                    <div class="data-navegacao">
                        <button id="data-anterior" class="data-nav-btn" title="Dia anterior">‚Üê</button>
                        <button id="data-atual" class="data-btn">
                            <span id="data-texto">Hoje</span>
                        </button>
                        <button id="data-proxima" class="data-nav-btn" title="Pr√≥ximo dia">‚Üí</button>
                    </div>
                </div>
                <div class="metricas-container">
                    <div class="metrica-item">
                        <span class="metrica-label">Not√≠cias Coletadas</span>
                        <span class="metrica-valor" id="metric-coletadas">--</span>
                    </div>
                    <div class="metrica-item">
                        <span class="metrica-label">Eventos √önicos</span>
                        <span class="metrica-valor" id="metric-eventos">--</span>
                    </div>
                    <div class="metrica-item">
                        <span class="metrica-label">Fontes Diferentes</span>
                        <span class="metrica-valor" id="metric-fontes">--</span>
                    </div>
                    <div class="metrica-item">
                        <span class="metrica-label">Com Resumo</span>
                        <span class="metrica-valor" id="metric-com-resumo">--</span>
                    </div>
                </div>
                <div class="header-actions">
                    <a href="/frontend/settings.html" class="btn btn-secondary">‚öôÔ∏è Settings</a>
                </div>
                <input type="date" id="data-input" class="data-input oculto">
            </div>

            <!-- Barra de Loading Progressivo -->
            <div id="loading-progress" class="loading-progress" style="display: none;">
                <div class="loading-bar-container">
                    <div id="loading-bar" class="loading-bar"></div>
                </div>
                <div id="loading-text" class="loading-text">Carregando...</div>
            </div>
            
            <!-- Abas Brasil/Internacional -->
            <div class="news-tabs-container">
                <nav class="news-tabs">
                    <button class="news-tab-btn ativo" data-tipo="nacional">
                        <svg class="flag-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 20" aria-hidden="true">
                            <rect width="28" height="20" fill="#009b3a"/>
                            <polygon points="14,2 26,10 14,18 2,10" fill="#ffdf00"/>
                            <circle cx="14" cy="10" r="5" fill="#002776"/>
                        </svg>
                        Brasil
                    </button>
                    <button class="news-tab-btn" data-tipo="internacional">üåç Internacional</button>
                </nav>
            </div>
            
            <div class="feed-noticias" id="feed-container">
                <!-- S√≠ntese Executiva ser√° inserida aqui dinamicamente -->
                <!-- Cards de clusters ser√£o inseridos aqui dinamicamente -->
            </div>
        </main>
    </div>

    <template id="card-template">
        <article class="card-cluster">
            <div class="card-header">
                <h3 class="card-titulo"></h3>
                <div class="card-contador-fontes" title="N√∫mero de fontes agrupadas">
                    <span>üì∞</span>
                    <span class="contador"></span>
                </div>
            </div>
            <p class="card-resumo"></p>
            <div class="card-footer">
                <span class="card-timestamp"></span>
                <div class="card-tags"></div>
            </div>
            <div class="card-actions" style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem;">
                <button class="btn btn-deep-dive">Detalhes ‚Üí</button>
                <button class="btn btn-secundario btn-expand-summary">Expandir</button>
            </div>
        </article>
    </template>

    <div id="modal-deep-dive" class="modal-overlay oculto">
        <div class="modal-container">
            <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            <header class="modal-header">
                <h2 id="modal-titulo"></h2>
                <div style="margin-left:auto;display:flex;gap:.5rem;align-items:center;">
                    <button id="modal-copy-btn" class="btn btn-secundario">üìã Copiar</button>
                    <button id="modal-expand-summary-btn" class="btn btn-secundario">‚§¥Ô∏é Expandir</button>
                    <button id="modal-like-btn" class="btn btn-secundario" title="Gostei (like)">üëç</button>
                    <button id="modal-dislike-btn" class="btn btn-secundario" title="N√£o gostei (dislike)">üëé</button>
                </div>
            </header>
            <div class="modal-body">
                <!-- Resumo e Fontes (sempre vis√≠vel) -->
                <div class="modal-resumo-section">
                    <h3>Resumo Executivo</h3>
                    <p id="modal-resumo"></p>
                    
                    <hr>
                    
                    <h3>Fontes Originais</h3>
                    <ul id="lista-fontes-container" class="lista-fontes"></ul>
                </div>
                
                <!-- Abas de funcionalidades -->
                <nav class="modal-tabs">
                    <button class="tab-btn ativo" data-tab="tab-chat">Conversar com o Cluster</button>
                    <button class="tab-btn" data-tab="tab-gerenciar">Gerenciar An√°lise</button>
                </nav>
                <div class="modal-content">
                    <div id="tab-chat" class="tab-content ativo">
                        <div class="chat-container">
                            <div class="chat-actions" style="display:flex;gap:.5rem;margin-bottom:.5rem;">
                                <button id="btn-deep-research" class="btn btn-secundario" title="Desativado" disabled>üîé Deep Research</button>
                                <button id="btn-social-research" class="btn btn-secundario" title="Desativado" disabled>#Ô∏è‚É£ Social (Grok4)</button>
                            </div>
                            <div class="chat-input-area">
                                <input type="text" id="chat-input" placeholder="Qual o impacto para os credores?">
                                <button id="chat-send-btn" class="btn">Enviar</button>
                            </div>
                            <div id="chat-messages" class="chat-messages">
                                <div class="message system">Fa√ßa uma pergunta sobre este evento.</div>
                            </div>
                            <div id="research-results" class="research-results"></div>
                        </div>
                    </div>
                    <div id="tab-gerenciar" class="tab-content oculto">
                        <h3>Editar Classifica√ß√£o</h3>
                        <div class="edit-form">
                            <div class="form-group">
                                <label for="edit-prioridade">Prioridade:</label>
                                <select id="edit-prioridade">
                                    <option value="P1_CRITICO">P1 - Cr√≠tico</option>
                                    <option value="P2_ESTRATEGICO">P2 - Estrat√©gico</option>
                                    <option value="P3_MONITORAMENTO">P3 - Monitoramento</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit-tags">Tags:</label>
                                <div class="tags-input">
                                    <input type="text" id="edit-tags-input" placeholder="Digite uma tag e pressione Enter">
                                    <div id="edit-tags-list" class="tags-list"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="edit-motivo">Motivo da Altera√ß√£o:</label>
                                <textarea id="edit-motivo" placeholder="Explique o motivo da altera√ß√£o..."></textarea>
                            </div>
                            <div class="form-actions">
                                <button id="save-changes-btn" class="btn btn-primary">Salvar Altera√ß√µes</button>
                                <button id="cancel-edit-btn" class="btn btn-terciario">Cancelar</button>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <h3>Hist√≥rico de Altera√ß√µes</h3>
                        <div id="alteracoes-container" class="alteracoes-list">
                            <!-- Hist√≥rico ser√° carregado dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Configura√ß√£o de Prompts -->
    <div id="modal-prompts-config" class="modal-overlay oculto">
        <div class="modal-container modal-large">
            <button id="modal-prompts-close-btn" class="modal-close-btn">&times;</button>
            <header class="modal-header">
                <h2>Configura√ß√£o de Prompts - Special Situations</h2>
            </header>
            <div class="modal-body">
                <div class="prompts-config-container">
                    <!-- Abas de configura√ß√£o -->
                    <nav class="prompts-tabs">
                        <button class="prompt-tab-btn ativo" data-tab="tab-tags">Tags</button>
                        <button class="prompt-tab-btn" data-tab="tab-prioridades">Prioridades</button>
                        <button class="prompt-tab-btn" data-tab="tab-prompt">Resumo/Clusterizador</button>
                        <button class="prompt-tab-btn" data-tab="tab-outros">Outros Prompts</button>
                    </nav>
                    
                    <div class="prompts-content">
                        <!-- Tab Tags Tem√°ticas -->
                        <div id="tab-tags" class="prompt-tab-content ativo">
                            <h3>Tags de Special Situations</h3>
                            <p class="config-description">
                                Configure as 8 categorias tem√°ticas para classifica√ß√£o de not√≠cias.
                            </p>
                            <div id="tags-config-container" class="config-editor">
                                <!-- Tags ser√£o carregadas dinamicamente -->
                            </div>
                        </div>
                        
                        <!-- Tab Prioridades -->
                        <div id="tab-prioridades" class="prompt-tab-content oculto">
                            <h3>Hierarquia de Prioridades</h3>
                            <p class="config-description">
                                Configure os n√≠veis de prioridade (P1, P2, P3) e seus crit√©rios.
                            </p>
                            <div id="prioridades-config-container" class="config-editor">
                                <!-- Prioridades ser√£o carregadas dinamicamente -->
                            </div>
                        </div>
                        
                        <!-- Tab Prompt Principal (agora usa PROMPT_AGRUPAMENTO_V1) -->
                        <div id="tab-prompt" class="prompt-tab-content oculto">
                            <h3>Prompt de Agrupamento (Resumo/Clusterizador)</h3>
                            <p class="config-description">
                                Este editor reflete exatamente o conte√∫do de `PROMPT_AGRUPAMENTO_V1` definido em `backend/prompts.py`.
                            </p>
                            <div class="prompt-editor">
                                <textarea id="prompt-principal-textarea" class="prompt-textarea" 
                                          placeholder="Digite o PROMPT_AGRUPAMENTO_V1 aqui..."></textarea>
                            </div>
                        </div>

                        <!-- Tab Outros Prompts -->
                        <div id="tab-outros" class="prompt-tab-content oculto">
                            <h3>Outros Prompts</h3>
                            <p class="config-description">Visualize/edite outros prompts do sistema diretamente de `backend/prompts.py`.</p>
                            <div class="prompt-editor">
                                <label for="prompt-resumo-final" style="display:block;margin-bottom:6px;color:#6C757D;">PROMPT_RESUMO_FINAL_V3</label>
                                <textarea id="prompt-resumo-final" class="prompt-textarea" placeholder="PROMPT_RESUMO_FINAL_V3"></textarea>
                            </div>
                            <div class="prompt-editor" style="margin-top:1rem;">
                                <label for="prompt-decisao-detalhado" style="display:block;margin-bottom:6px;color:#6C757D;">PROMPT_DECISAO_CLUSTER_DETALHADO_V1</label>
                                <textarea id="prompt-decisao-detalhado" class="prompt-textarea" placeholder="PROMPT_DECISAO_CLUSTER_DETALHADO_V1"></textarea>
                            </div>
                            <div class="prompt-editor" style="margin-top:1rem;">
                                <label for="prompt-chat-cluster" style="display:block;margin-bottom:6px;color:#6C757D;">PROMPT_CHAT_CLUSTER_V1</label>
                                <textarea id="prompt-chat-cluster" class="prompt-textarea" placeholder="PROMPT_CHAT_CLUSTER_V1"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√µes de a√ß√£o -->
                    <div class="prompts-actions">
                        <button id="save-prompts-btn" class="btn btn-primary">Salvar Configura√ß√µes</button>
                        <button id="cancel-prompts-btn" class="btn btn-terciario">Cancelar</button>
                        <button id="reset-prompts-btn" class="btn btn-secondary">Restaurar Padr√£o</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/frontend/script.js?v=1.0.32"></script>
    <div id="modal-estagiario" class="modal-overlay oculto">
        <div class="modal-container" style="max-width:560px;height:auto;">
            <button class="modal-close-btn" onclick="document.getElementById('modal-estagiario').classList.add('oculto')">&times;</button>
            <header class="modal-header">
                <h2>ü§ñ Estagi√°rio ‚Äî Processando</h2>
            </header>
            <div class="modal-body">
                <div style="display:flex;gap:1rem;align-items:center;">
                    <div class="spinner" style="width:32px;height:32px;border-width:3px"></div>
                    <p id="estagiario-status-text">Entendendo pergunta...</p>
                </div>
                <div id="estagiario-steps" style="margin-top:.75rem;color:#6C757D;font-size:.9rem;"></div>
            </div>
        </div>
    </div>

    <div id="modal-estagiario-chat" class="modal-overlay oculto">
        <div class="modal-container" style="width:90vw;height:88vh;max-width:none;">
            <button class="modal-close-btn" onclick="document.getElementById('modal-estagiario-chat').classList.add('oculto')">&times;</button>
            <header class="modal-header">
                <h2>ü§ñ Estagi√°rio ‚Äî Chat</h2>
                <div style="margin-left:auto;display:flex;gap:.5rem;align-items:center;">
                    <button id="btn-estagiario-copiar" class="btn btn-secundario" title="Copiar resposta">üìã Copiar</button>
                    <button id="btn-estagiario-historico" class="btn btn-terciario" title="Ver conversas de hoje">üïò Hist√≥rico</button>
                </div>
            </header>
            <div class="modal-body">
                <div class="chat-container" style="display:flex;flex-direction:column;">
                    <div style="display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;">
                        <select id="estagiario-history-select" class="btn-terciario" style="padding:.5rem;border-radius:6px;border:1px solid var(--cor-borda);background:#fff;">
                            <option value="">Hist√≥rico de conversas de hoje</option>
                        </select>
                    </div>
                    <div id="estagiario-thread-modal" class="chat-messages" style="min-height:50vh;"></div>
                    <div class="chat-input-area">
                        <input type="text" id="estagiario-input-modal" placeholder="Pergunte algo...">
                        <button class="btn" id="estagiario-send-modal">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>